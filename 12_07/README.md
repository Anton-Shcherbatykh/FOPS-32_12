# Домашнее задание к занятию «Репликация и масштабирование. Часть 2» (Щербатых А.Е.)
## Задание 1
Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер;
- master-сервер и несколько slave-серверов;

*Дайте ответ в свободной форме.*

## Ответ

**Активный Master-сервер и пассивный репликационный Slave-сервер**

Архитектура:

``` text
┌─────────────┐    ┌─────────────┐
│   MASTER    │───▶│   SLAVE     │
│  (Active)   │    │ (Passive)   │
│ Read/Write  │    │ Read Only   │
└─────────────┘    └─────────────┘
```
Основные преимущества:

### А. Отказоустойчивость и восстановление

**Резервное копирование в реальном времени**: Slave постоянно синхронизирован с Master 

**Быстрое восстановление**: При падении Master можно быстро переключиться на Slave

**Тестирование обновлений**: На Slave можно тестировать обновления БД без риска для production

### Б. Распределение нагрузки

**Оффлоад бэкапов**: Резервное копирование выполняется на Slave, не нагружая Master

**Аналитические запросы**: Тяжелые отчеты и аналитика выполняются на Slave

### В. Безопасность и разработка

**Изоляция данных**: Разработчики могут работать со Slave без риска повреждения production-данных

**Географическое распределение**: Slave может находиться в другом ЦОД для защиты от сбоев

**Master-сервер и несколько Slave-серверов**

Архитектура:

``` text
              ┌─────────────┐
              │   MASTER    │
              │  (Active)   │
              │ Read/Write  │
              └─────────────┘
                     │
    ┌────────────────┼────────────────┐
    │                │                │
┌───────┐        ┌───────┐        ┌───────┐
│SLAVE 1│        │SLAVE 2│        │SLAVE 3│
│(Read) │        │(Read) │        │(Read) │
└───────┘        └───────┘        └───────┘
```
Основные преимущества:
### А. Масштабирование чтения ###

**Распределение нагрузки**: Запросы на чтение распределяются между несколькими Slave

**Высокая доступность**: При падении одного Slave другие продолжают работать

**Линейное масштабирование**: Можно добавлять Slave для увеличения производительности чтения

### Б. Географическое распределение ###

**Локализация данных**: Slave могут находиться в разных регионах для уменьшения задержек

**Отказоустойчивость**: Сбой в одном дата-центре не остановит работу системы

### В. Специализация серверов ###

**Slave для отчетности**: Выделенный сервер для тяжелых аналитических запросов

**Slave для кэширования**: Сервер для часто запрашиваемых данных

**Slave для разработки**: Отдельный сервер для тестирования

## Задание 2
Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:

- пользователи,
- книги,
- магазины (столбцы произвольно)
  
Опишите принципы построения системы и их разграничение или разбивку между базами данных.

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.*

### Архитектура системы
**Горизонтальный шардинг (по данным)**
Принцип: Разделение данных одной таблицы между разными серверами по ключу шардинга

**Вертикальный шардинг (по функционалу)**
Принцип: Разделение таблиц между разными серверами по функциональному назначению

### Схема разбивки данных
``` text
┌─────────────────────────────────────────────────────────────┐
│                    ШАРДИНГ СИСТЕМА                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ВЕРТИКАЛЬНЫЙ ШАРДИНГ (по типу данных)                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────────┐│
│  │  ШАРД USERS     │  │  ШАРД BOOKS     │  │ ШАРД STORES   ││
│  │  (Пользователи) │  │  (Книги)        │  │ (Магазины)    ││
│  └─────────────────┘  └─────────────────┘  └───────────────┘│
│                                                             │
│  ГОРИЗОНТАЛЬНЫЙ ШАРДИНГ (внутри каждого вертикального шарда)│
│  ┌──────┐ ┌──────┐   ┌──────┐ ┌──────┐    ┌──────┐ ┌──────┐ │
│  │USR_S1│ │USR_S2│   │BK_S1 │ │BK_S2 │    │ST_S1 │ │ST_S2 │ │
│  └──────┘ └──────┘   └──────┘ └──────┘    └──────┘ └──────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Детальный план реализации
1. Вертикальный шардинг - разделение по таблицам
   
**Шард USERS (Сервер 1):**

``` sql
-- Таблица пользователей
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    email VARCHAR(255),
    name VARCHAR(100),
    registration_date DATETIME,
    country_code VARCHAR(3)
) sharding_key = user_id;
```
